<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: lib/pipe.class.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: lib/pipe.class.js</h1>

    


    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>var lob = require('lob-enc');
var util = require('util')
var log = require("./util/log")("Pipe")
var events = require('events');
var countListeners = events.EventEmitter.listenerCount;
var KEEPALIVE = null;

util.inherits(Pipe, events.EventEmitter)

var uids = 0;

/** A Pipe is a simple eventemmiter that bridges between telehash transports and {TLink}s
 * @class Pipe
 * @constructor
 * @param {string} type - 'udp4', 'tcp4', 'http-client' etc.
 * @param {number} keepalive - the amaount of time between keepalive events
 * @return {Pipe}
 */
function Pipe(type, keepalive)
{
  this.type = type;
  this.isPipe = true;
  this.uid = uids++;
  this.cloaked = false;

  if(keepalive || KEEPALIVE)
    this.keepalive(KEEPALIVE || keepalive);
  return this;
}

Pipe.keepalive = function PIPE_KEEPALIVE(timeout){
  KEEPALIVE = timeout;
}

/** Clear the previous keepalive interval and set a new one (or just clear it)
 * @param {number=} timeout - the interval
 * @fires Pipe#keepalive
 */

Pipe.prototype.keepalive = function Pipe_keepalive(timeout)
{
  clearInterval(this.timer);
  /**
   * keepalive event. used by Link to manage connectivity over multiple pipes
   *
   * @event Pipe#keepalive
   * @type {null}
   */
  if(typeof timeout === 'number'){
    this.timer = setInterval(function keepalive_interval(pipe){
      if (!pipe.emit('keepalive'))
        clearInterval(pipe.timer);
    }, timeout, this);
  }
}


/** this triggers the send mechanism of the underlying transport.
 * @param {Buffer=} packet - handshake, open, or an ordinary packet...
 * @param {TLink=} link -
 * @param {function=} callback - called after the packet is sent
 * @fires Pipe#send
 */
Pipe.prototype.send = function Pipe_send()
{
  this.keepalive();
  this.sentAt = Date.now();
  if(!countListeners(this,'send') &amp;&amp; !this.onSend)
    return log.error('internal error, no pipe.onSend');
  // automatically add cloaking
  if(this.cloaked &amp;&amp; lob.isPacket(arguments[0]))
    arguments[0] = lob.cloak(arguments[0]);

  if (!this.onSend)
    this.emit('send',this,arguments[0], arguments[1], arguments[2], arguments[3], arguments[4]);
  else
    this.onSend.apply(this, arguments)
},


module.exports = Pipe;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Classes</h3><ul><li><a href="ChannelStream.html">ChannelStream</a></li><li><a href="Mesh.html">Mesh</a></li><li><a href="Pipe.html">Pipe</a></li><li><a href="TLink.html">TLink</a></li></ul><h3>Events</h3><ul><li><a href="Pipe.html#event:keepalive">keepalive</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-alpha5</a> on Sat Aug 08 2015 17:33:47 GMT-0600 (MDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
